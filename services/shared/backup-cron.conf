# Phase 6: Automated Backup Cron Configuration
# This file configures automated database backups
#
# Installation:
# 1. Copy this file to /etc/cron.d/lets-connect-backup
# 2. Ensure backup scripts are in /opt/lets-connect/services/shared/
# 3. Create backup directory: mkdir -p /backups
# 4. Set environment variables in /etc/environment or .env file
#
# Environment variables required:
# - POSTGRES_HOST (default: postgres)
# - POSTGRES_PORT (default: 5432)
# - POSTGRES_USER (default: postgres)
# - POSTGRES_PASSWORD
# - BACKUP_DIR (default: /backups)
# - RETENTION_DAYS (default: 30)

# Backup schedule (using standard cron format)
# Format: minute hour day-of-month month day-of-week command

# Daily full backup at 2:00 AM
0 2 * * * root /opt/lets-connect/services/shared/backup-db.sh >> /var/log/lets-connect-backup.log 2>&1

# Weekly backup at 3:00 AM on Sundays (verify-backup.sh not yet implemented)
# 0 3 * * 0 root /opt/lets-connect/services/shared/backup-db.sh && /opt/lets-connect/services/shared/verify-backup.sh >> /var/log/lets-connect-backup-verify.log 2>&1

# Hourly incremental backup (for point-in-time recovery)
# Uncomment if using PostgreSQL WAL archiving
# 0 * * * * root /opt/lets-connect/services/shared/backup-wal.sh >> /var/log/lets-connect-wal-backup.log 2>&1

# Monthly backup retention cleanup (first day of each month at 4:00 AM)
0 4 1 * * root find /backups -name "*.sql.gz" -mtime +30 -delete && find /backups -name "*.meta" -mtime +30 -delete >> /var/log/lets-connect-backup-cleanup.log 2>&1
